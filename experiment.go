package evaluation

import "gopkg.in/launchdarkly/go-sdk-common.v2/ldreason"

// IsExperimentationEnabled tests whether an evaluation of the specified flag can be included in an
// experiment. This may depend on the way the evaluation was computed, so the second parameter is the
// EvaluationReason that was generated by the evaluation.
func IsExperimentationEnabled(flag FeatureFlag, reason ldreason.EvaluationReason) bool {
	switch reason.GetKind() {
	case ldreason.EvalReasonFallthrough:
		return flag.TrackEventsFallthrough
	case ldreason.EvalReasonRuleMatch:
		i := reason.GetRuleIndex()
		if i >= 0 && i < len(flag.Rules) {
			return flag.Rules[i].TrackEvents
		}
	}
	return false
}
